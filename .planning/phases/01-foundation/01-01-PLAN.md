---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNotes.qml
  - ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNoteContent.qml
  - ~/.config/quickshell/ii/services/StickyNotesService.qml
  - ~/.config/quickshell/ii/modules/common/Directories.qml
autonomous: true

must_haves:
  truths:
    - "Sticky notes data file is created at ~/.local/share/quickshell/sticky-notes.json"
    - "StickyNotesService loads and saves note data via FileView"
    - "Module files exist and are syntactically valid QML"
  artifacts:
    - path: "~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNotes.qml"
      provides: "Main module component with Scope wrapper"
      min_lines: 20
    - path: "~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNoteContent.qml"
      provides: "Note content component with text area"
      min_lines: 40
    - path: "~/.config/quickshell/ii/services/StickyNotesService.qml"
      provides: "Data persistence singleton service"
      min_lines: 60
    - path: "~/.config/quickshell/ii/modules/common/Directories.qml"
      provides: "Updated with stickyNotesPath property"
      contains: "stickyNotesPath"
  key_links:
    - from: "StickyNotesService.qml"
      to: "Directories.stickyNotesPath"
      via: "FileView path property"
      pattern: "Directories\\.stickyNotesPath"
    - from: "StickyNotesService.qml"
      to: "FileView"
      via: "JSON persistence"
      pattern: "FileView"
---

<objective>
Create the core sticky notes module infrastructure with data persistence.

Purpose: Establish the foundational components that Plan 02 will build upon - the data service, content component, and module shell. This separates infrastructure from window/IPC wiring.

Output: Working StickyNotesService with FileView persistence, StickyNoteContent component with styled text area, and StickyNotes module skeleton ready for window integration.
</objective>

<execution_context>
@/home/sammy/.claude/get-shit-done/workflows/execute-plan.md
@/home/sammy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/sammy/.config/hypr/.planning/PROJECT.md
@/home/sammy/.config/hypr/.planning/ROADMAP.md
@/home/sammy/.config/hypr/.planning/phases/01-foundation/01-RESEARCH.md

# Reference patterns
@/home/sammy/.config/quickshell/ii/services/Todo.qml
@/home/sammy/.config/quickshell/ii/modules/ii/overlay/notes/NotesContent.qml
@/home/sammy/.config/quickshell/ii/modules/common/Directories.qml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StickyNotesService with FileView persistence</name>
  <files>
    ~/.config/quickshell/ii/services/StickyNotesService.qml
    ~/.config/quickshell/ii/modules/common/Directories.qml
  </files>
  <action>
1. Update Directories.qml to add stickyNotesPath property:
   ```qml
   property string stickyNotesPath: FileUtils.trimFileProtocol(
       `${StandardPaths.standardLocations(StandardPaths.GenericDataLocation)[0]}/quickshell/sticky-notes.json`
   )
   ```
   This stores data in ~/.local/share/quickshell/sticky-notes.json (survives config resets per user requirement).

2. Create StickyNotesService.qml as a singleton service following Todo.qml pattern:
   - Import qs.modules.common for Directories
   - Property `notes`: array of note objects
   - Each note object has: id (uuid), content (string), x (real), y (real), width (real), height (real), visible (bool), monitor (string), lastActive (timestamp), zIndex (int)
   - FileView for loading/saving JSON
   - Timer for debounced saves (500ms like NotesContent)
   - Functions: createNote(), deleteNote(id), updateNote(id, props), getNote(id), toggleNote(id), showAll(), hideAll()
   - createNote() should generate UUID via `Qt.createQmlObject` or simple timestamp+random
   - Default note size: 300x200, default position: center of screen (can be refined later)
   - Save on any note change (debounced)
   - Handle FileViewError.FileNotFound by initializing empty array

3. Ensure Component.onCompleted creates the parent directory:
   ```qml
   Quickshell.execDetached(["mkdir", "-p",
       FileUtils.trimFileProtocol(`${StandardPaths.standardLocations(StandardPaths.GenericDataLocation)[0]}/quickshell`)])
   ```
  </action>
  <verify>
    - File exists at ~/.config/quickshell/ii/services/StickyNotesService.qml
    - File exists at ~/.config/quickshell/ii/modules/common/Directories.qml with stickyNotesPath
    - QML syntax valid: `qmlscene --check ~/.config/quickshell/ii/services/StickyNotesService.qml` (may show import errors but no syntax errors)
  </verify>
  <done>
    - StickyNotesService.qml exists with FileView persistence
    - Directories.qml has stickyNotesPath pointing to ~/.local/share/quickshell/sticky-notes.json
    - Service has createNote, deleteNote, updateNote, toggleNote, showAll, hideAll functions
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StickyNoteContent component</name>
  <files>
    ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNoteContent.qml
  </files>
  <action>
1. Create directory: mkdir -p ~/.config/quickshell/ii/modules/ii/stickyNotes/

2. Create StickyNoteContent.qml following NotesContent.qml pattern but simplified:
   - Import QtQuick, QtQuick.Controls, qs.modules.common (for StyledTextArea, Appearance)
   - Root item with id: root
   - Properties: content (string, alias to textInput.text), noteId (string)
   - ColumnLayout containing:
     - ScrollView with StyledTextArea for text input
     - Use StyledTextArea (existing component) - NOT hand-rolled TextArea
   - StyledTextArea properties:
     - wrapMode: TextEdit.Wrap
     - placeholderText: "Write something..."
     - selectByMouse: true
     - textFormat: TextEdit.PlainText
     - padding: 16
   - Function focusAtEnd() - calls textInput.forceActiveFocus() and moves cursor to end
   - Signal contentChanged(string newContent) - emitted on text change (debounced via Timer)
   - Timer for debounced content change signal (300ms)

3. Style to match ii/ aesthetic:
   - Use Appearance.colors for theming
   - Background via OverlayBackground or Rectangle with Appearance.colors.colLayer1
   - Rounded corners: Appearance.rounding.normal or similar
  </action>
  <verify>
    - File exists at ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNoteContent.qml
    - Contains StyledTextArea (not hand-rolled)
    - Has focusAtEnd() function
    - Has contentChanged signal
  </verify>
  <done>
    - StickyNoteContent.qml exists with styled text input
    - Component has content property, noteId property, focusAtEnd function
    - Uses existing StyledTextArea for consistent theming
  </done>
</task>

<task type="auto">
  <name>Task 3: Create StickyNotes module skeleton</name>
  <files>
    ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNotes.qml
  </files>
  <action>
1. Create StickyNotes.qml as main module entry point following Overlay.qml pattern:
   - Import statements matching Overlay.qml (QtQuick, Quickshell, Quickshell.Wayland, etc.)
   - Root Scope component (like Overlay.qml uses)
   - Import qs.services for StickyNotesService

2. Module structure (skeleton for Plan 02 to complete):
   - Comment placeholder for Repeater that will create StickyNoteWindow instances
   - Comment placeholder for IpcHandler (will be added in Plan 02)
   - Comment placeholder for GlobalShortcut (will be added in Plan 02)

3. Add basic property to reference service:
   ```qml
   property var notesService: StickyNotesService
   ```

4. This is intentionally minimal - Plan 02 adds the window creation, IPC, and keybinds.
  </action>
  <verify>
    - File exists at ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNotes.qml
    - Uses Scope as root component
    - Has import for qs.services
    - Has notesService property
  </verify>
  <done>
    - StickyNotes.qml module skeleton exists
    - Module uses Scope root (matches Overlay.qml pattern)
    - Ready for Plan 02 to add window creation and IPC
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. All three QML files exist in correct locations
2. Directories.qml has stickyNotesPath property
3. No QML syntax errors (basic qmlscene --check or manual review)
4. Service follows FileView persistence pattern from Todo.qml
5. Content component follows NotesContent.qml patterns
</verification>

<success_criteria>
- StickyNotesService.qml handles note CRUD and persistence to ~/.local/share/quickshell/sticky-notes.json
- StickyNoteContent.qml provides styled text input matching ii/ aesthetic
- StickyNotes.qml exists as module skeleton ready for window/IPC integration
- Directories.qml updated with stickyNotesPath
- All files follow existing codebase patterns and conventions
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
