---
phase: 01-foundation
task: sticky-notes-improvements
status: in_progress
last_updated: 2026-02-22T22:31:41Z
---

<current_state>
Implementing 9 improvements to the Sticky Notes panel. All code changes are COMPLETE and staged
in `.staging/` directory — NOT yet deployed to live files. The live Quickshell environment has
only received 3 non-disruptive changes (Directories.qml, Persistent.qml, dead file removal).
The 2 main QML files with all UI changes are sitting in staging, ready to swap in.
</current_state>

<completed_work>

## Already applied to live files:
1. **Checkpoint backup** — All original files backed up to `.backup-2026-02-17/` inside stickyNotes dir
2. **Storage location changed** — `~/Documents/Notes/sticky-notes.json` (was `~/.local/share/quickshell/`)
   - Directories.qml: `stickyNotesPath` updated + mkdir in Component.onCompleted
   - Data migrated: `cp` from old location to new
3. **Dead files removed** — `StickyNoteWindow.qml` and `StickyNoteContent.qml` deleted (backups exist)
4. **Panel persistence added** — `Persistent.qml`: new `stickyNotes` JsonObject with panelX/Y/Width/Height

## Completed in staging (NOT yet deployed):
5. **Auto-select most recent note** — `selectMostRecent()` function in PanelContent, called from Panel on toggle/open
6. **Search/filter** — TextField with search icon above note list, filters by content match
7. **Keyboard navigation** — FocusScope wrapping list, Up/Down arrows cycle notes, Enter confirms
8. **Markdown preview** — Toggle button in toolbar (Edit/Preview), read-only TextArea with MarkdownText format
9. **Sort by most recent first** — `filteredNotes` sorts by `lastActive` descending

</completed_work>

<remaining_work>

- **Deploy staging files to live** — Copy 2 files from `.staging/` to live location
  - `StickyNotesPanelContent.qml` (main UI changes: search, sort, keyboard nav, markdown, auto-select)
  - `StickyNotesPanel.qml` (persistence bindings + auto-select calls)
- **Test all features** after deployment
- **Clean up** `.staging/` directory after successful deployment

</remaining_work>

<decisions_made>

1. **Staging workflow** — Editing live QML files disrupts the running Quickshell desktop. All changes
   made to copies in `.staging/` directory, to be swapped in atomically.
2. **Markdown as toggle** — Edit mode is plain text, Preview mode renders markdown via `TextEdit.MarkdownText`.
   Avoids round-trip formatting issues that occur with always-on markdown editing.
3. **Sort by lastActive** — Most recently touched notes appear first. Simple and intuitive.
4. **Storage in ~/Documents/Notes/** — User requested. More visible/accessible than ~/.local/share/quickshell/
5. **Panel persistence via Persistent.qml** — Follows existing pattern (overlay widgets use same system).
   Uses -1 sentinel for panelX/Y to indicate "not set yet, center on screen".

</decisions_made>

<blockers>
- **Deployment requires Quickshell restart** — Cannot safely hot-reload because two files must update
  together. Copying one at a time risks parse errors from mismatched references.
- **Safe deploy procedure**: `killall quickshell`, copy staging files, restart quickshell
</blockers>

<context>
The sticky notes feature was already reimplemented as a standalone panel (not overlay) in a previous
session. This session added quality-of-life improvements. All code is written and staged — just needs
deployment and testing.

The user is cautious about disrupting their desktop — they explicitly asked to pause rather than deploy
because they can't afford a restart right now.

Backup exists at: `~/.config/quickshell/ii/modules/ii/stickyNotes/.backup-2026-02-17/`
Staging lives at: `~/.config/quickshell/ii/modules/ii/stickyNotes/.staging/`
</context>

<next_action>
1. When user is ready to restart Quickshell, deploy with:
   ```bash
   killall quickshell
   cp ~/.config/quickshell/ii/modules/ii/stickyNotes/.staging/StickyNotesPanelContent.qml ~/.config/quickshell/ii/modules/ii/stickyNotes/
   cp ~/.config/quickshell/ii/modules/ii/stickyNotes/.staging/StickyNotesPanel.qml ~/.config/quickshell/ii/modules/ii/stickyNotes/
   ```
   Then restart Quickshell (user's normal method).
2. Test: Super+Shift+G to toggle panel, verify auto-select, search, arrow keys, markdown preview, sorting
3. Clean up `.staging/` directory after confirming everything works
</next_action>

<files_modified>
**Live (applied):**
- ~/.config/quickshell/ii/modules/common/Directories.qml (storage path change)
- ~/.config/quickshell/ii/modules/common/Persistent.qml (panel persistence)
- ~/Documents/Notes/sticky-notes.json (migrated data)
- DELETED: ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNoteWindow.qml
- DELETED: ~/.config/quickshell/ii/modules/ii/stickyNotes/StickyNoteContent.qml

**Staging (ready to deploy):**
- ~/.config/quickshell/ii/modules/ii/stickyNotes/.staging/StickyNotesPanelContent.qml
- ~/.config/quickshell/ii/modules/ii/stickyNotes/.staging/StickyNotesPanel.qml

**Backups:**
- ~/.config/quickshell/ii/modules/ii/stickyNotes/.backup-2026-02-17/ (all original files)
</files_modified>
