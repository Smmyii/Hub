# Desktop Architecture & File Map

## The Big Picture

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Sammy's Desktop                              │
│                                                                     │
│  ┌──────────────┐   ┌──────────────────┐   ┌────────────────────┐  │
│  │   Hyprland   │   │    Quickshell    │   │       Kitty        │  │
│  │  (Compositor)│──▶│  (Desktop Shell) │   │    (Terminal)      │  │
│  │              │   │                  │   │                    │  │
│  │ Windows      │   │ Bar, Panels,     │   │ Tabs, Splits,     │  │
│  │ Workspaces   │   │ Overlays,        │   │ Fish shell         │  │
│  │ Keybindings  │   │ Sticky Notes,    │   │                    │  │
│  │ Rules        │   │ Search, Emoji,   │   │                    │  │
│  │ Scripts      │   │ Clipboard        │   │                    │  │
│  └──────┬───────┘   └────────┬─────────┘   └────────────────────┘  │
│         │                    │                                      │
│         │  IPC ($qsConfig)   │                                      │
│         └────────────────────┘                                      │
│                                                                     │
│  ┌──────────────┐   ┌──────────────────┐   ┌────────────────────┐  │
│  │   Hyprlock   │   │    Hypridle      │   │   System Services  │  │
│  │ (Lock Screen)│   │ (Idle Daemon)    │   │ Keyring, Cliphist, │  │
│  │              │   │                  │   │ EasyEffects, D-Bus │  │
│  └──────────────┘   └──────────────────┘   └────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

The desktop is a Wayland-native stack. **Hyprland** is the compositor (window management, keybindings, display layout). **Quickshell** provides the UI shell (bars, panels, overlays, custom widgets like sticky notes). **Kitty** is the terminal. Everything else is support services.

## How the Pieces Connect

```
User presses a key
  → Hyprland keybind matches (hyprland/keybinds.conf)
    → Option A: Direct dispatch (movefocus, workspace, killactive)
    → Option B: IPC to Quickshell (qs -c $qsConfig ipc call <target>)
    → Option C: Shell script (~/.config/hypr/hyprland/scripts/*.sh)
      → Script calls hyprctl, playerctl, brightnessctl, etc.
      → Falls back to fuzzel if Quickshell unavailable
```

```
Quickshell starts (via exec-once in execs.conf)
  → Loads config from ~/.config/quickshell/ii/
  → Services initialize (Audio, Battery, Clipboard, DateTime, StickyNotes...)
  → Modules render UI (bar, sidebars, overlays, sticky notes...)
  → Listens for IPC commands from Hyprland keybinds
  → Listens for GlobalShortcut registrations from modules
```

```
Hyprland startup sequence (hyprland.conf):
  1. Set $qsConfig = ii
  2. Enable global submap (required for keybinds to work)
  3. Source base configs: env → execs → general → rules → colors → keybinds
  4. Source custom overrides: env → execs → general → rules → keybinds
  5. Source display layout: workspaces.conf → monitors.conf
```

## Full File Map

### Hyprland — Window Manager

```
~/.config/hypr/                              ← Config root (symlinked from ~/Documents/Config/hypr/)
├── hyprland.conf                            ← ENTRY POINT — sources everything in order
├── monitors.conf                            ← Monitor definitions (auto-generated by nwg-displays)
├── workspaces.conf                          ← Workspace-to-monitor mapping (auto-generated)
├── hypridle.conf                            ← Idle daemon: screen lock after 5min, sleep after 30min
├── hyprlock.conf                            ← Lock screen appearance and behavior
│
├── hyprland/                                ← Base configuration (illogical-impulse defaults)
│   ├── env.conf                             ← Environment vars (Wayland, Qt, Electron hints)
│   ├── execs.conf                           ← Startup services (Quickshell, keyring, clipboard, audio)
│   ├── general.conf                         ← Compositor settings (gaps, animations, input, gestures)
│   ├── rules.conf                           ← Window/layer rules (float, blur, tiling behavior)
│   ├── colors.conf                          ← Color palette definitions
│   ├── keybinds.conf                        ← All keybindings (~22K lines, organized by section)
│   └── scripts/                             ← Utility scripts called by keybinds
│       ├── workspace_action.sh              ← Translates workspace numbers for multi-monitor
│       ├── launch_first_available.sh        ← Tries app commands until one succeeds (fallback chain)
│       ├── zoom.sh                          ← Cursor zoom (1.0x–3.0x range)
│       ├── snip_to_search.sh               ← Screenshot → Google Lens search
│       ├── fuzzel-emoji.sh                  ← Emoji picker (fallback when Quickshell unavailable)
│       ├── start_geoclue_agent.sh           ← Location services init
│       └── ai/                              ← AI integration
│           ├── primary-buffer-query.sh      ← Send clipboard to Ollama for processing
│           └── show-loaded-ollama-models.sh ← Query active LLM models
│
├── custom/                                  ← User overrides (sourced AFTER base, takes priority)
│   ├── env.conf                             ← Custom environment variables
│   ├── execs.conf                           ← Custom startup services
│   ├── general.conf                         ← Custom general settings
│   ├── rules.conf                           ← Custom window/layer rules
│   ├── keybinds.conf                        ← Custom keybindings
│   └── scripts/
│       └── __restore_video_wallpaper.sh     ← Auto-generated by wallpaper switcher
│
├── hyprlock/                                ← Lock screen assets
│   ├── colors.conf                          ← Lock screen colors (matugen-generated)
│   ├── status.sh                            ← Status display (time, battery, etc.)
│   └── check-capslock.sh                    ← Capslock indicator
│
└── shaders/                                 ← GPU shaders for visual effects
    ├── (chromatic aberration, CRT, inversion, solarized...)
```

**Override pattern:** Base files in `hyprland/` set defaults. Custom files in `custom/` override selectively. Order matters — custom is sourced last, so it wins.

### Quickshell — Desktop Shell (illogical-impulse)

```
~/.config/quickshell/ii/                     ← Quickshell config ($qsConfig = ii)
├── services/                                ← Singleton services (data, state, system integrations)
│   ├── StickyNotesService.qml               ← ★ BUILT BY CLAUDE — sticky notes persistence
│   ├── Audio.qml                            ← PipeWire volume/device control
│   ├── Battery.qml                          ← Battery state monitoring
│   ├── Brightness.qml                       ← Screen brightness
│   ├── Cliphist.qml                         ← Clipboard history
│   ├── DateTime.qml                         ← Clock/calendar
│   ├── Ai.qml                               ← AI integration service
│   ├── Emojis.qml                           ← Emoji data/search
│   ├── Todo.qml                             ← Todo persistence (pattern reference for StickyNotes)
│   ├── AppSearch.qml                        ← Application launcher search
│   ├── HyprlandData.qml                     ← Hyprland state via IPC
│   └── ...                                  ← ~30+ services total
│
├── modules/ii/                              ← UI modules (each renders a desktop component)
│   ├── stickyNotes/                         ← ★ BUILT BY CLAUDE — sticky notes widget
│   │   ├── StickyNotes.qml                  ← Main module entry (Scope + IPC + GlobalShortcuts)
│   │   ├── StickyNotesPanel.qml             ← Panel window that hosts all notes
│   │   ├── StickyNotesPanelContent.qml      ← Panel content layout (grid of notes)
│   │   ├── StickyNoteWindow.qml             ← Individual note window component
│   │   └── StickyNoteContent.qml            ← Text area with auto-scroll and debounced save
│   ├── bar/                                 ← Top bar (system tray, clock, workspaces)
│   ├── sidebarLeft/                         ← Left sidebar panel
│   ├── sidebarRight/                        ← Right sidebar panel
│   ├── overlay/                             ← Super+G overlay (dashboard with widgets)
│   │   └── notes/                           ← Original notes widget (overlay-only)
│   ├── overview/                            ← Workspace overview
│   ├── cheatsheet/                          ← Keybinding cheatsheet overlay
│   ├── dock/                                ← Application dock
│   ├── lock/                                ← Lock screen UI
│   ├── notificationPopup/                   ← Notification bubbles
│   ├── onScreenDisplay/                     ← Volume/brightness OSD
│   ├── onScreenKeyboard/                    ← Virtual keyboard
│   ├── mediaControls/                       ← Media player controls
│   ├── wallpaperSelector/                   ← Wallpaper picker
│   ├── sessionScreen/                       ← Logout/reboot/shutdown screen
│   ├── regionSelector/                      ← Screen region selection
│   ├── polkit/                              ← Authentication dialogs
│   ├── screenCorners/                       ← Hot corners
│   ├── background/                          ← Desktop background
│   └── verticalBar/                         ← Alternative bar layout
│
└── modules/common/                          ← Shared components and utilities
    ├── Directories.qml                      ← File paths (including stickyNotesPath)
    ├── Appearance.qml                       ← Theme colors, rounding, fonts
    └── ...                                  ← Shared UI components
```

### Kitty — Terminal Emulator

```
~/.config/kitty/
├── kitty.conf                               ← ★ CONFIGURED BY CLAUDE — full terminal config
└── kitty.conf.backup                        ← Original config before Claude modifications
```

**kitty.conf breakdown (104 lines):**
- Font: JetBrains Mono Nerd Font, 11pt
- Cursor: Beam style with trail effect
- Shell: Fish
- Tab bar: Top, powerline/rounded style, theme-matched colors
- Layouts: Tall, fat, splits, stack (4 enabled)
- Split colors: Cyan active (`#0DB7D4`), dark gray inactive (`#313136`)
- Keybindings: Tabs (new, close, cycle, jump 1-5, move, rename), Splits (create, navigate, resize, zoom), Copy, Search, Scroll, Zoom

### Fish Shell

```
~/.config/fish/
├── config.fish                              ← Shell config (prompt, environment)
└── ...                                      ← Functions, completions, etc.
```

### Sticky Notes — Data

```
~/.local/share/quickshell/
└── sticky-notes.json                        ← Note data (persists across reboots)
```

**JSON schema (version 1):**
```json
{
  "version": 1,
  "nextZIndex": 5,
  "notes": [
    {
      "id": "lz3k5m-a8b2c9d1",
      "content": "Note text here",
      "x": 115, "y": 97,
      "width": 280, "height": 220,
      "visible": true,
      "archived": false,
      "monitor": "",
      "color": "#d4c896",
      "lastActive": 1738512000000,
      "zIndex": 3
    }
  ]
}
```

## Component Details

### Hyprland

| Aspect | Detail |
|--------|--------|
| **Role** | Wayland compositor — windows, workspaces, keybindings, display management |
| **Config entry** | `~/.config/hypr/hyprland.conf` |
| **Config pattern** | Base + override: `hyprland/*.conf` then `custom/*.conf` (last write wins) |
| **IPC** | `hyprctl` CLI + Quickshell IPC via `qs -c ii ipc call <target>` |
| **Key env vars** | `$qsConfig=ii`, `$TERMINAL=kitty -1`, `QT_QPA_PLATFORM=wayland` |
| **Plugin system** | `hyprpm` for loading Hyprland plugins at startup |
| **Display config** | Auto-generated by `nwg-displays` — don't edit manually |
| **Reload** | `Ctrl+Super+R` restarts widgets; config changes mostly live-reload |

### Quickshell (illogical-impulse)

| Aspect | Detail |
|--------|--------|
| **Role** | QML-based desktop shell — all UI beyond window borders |
| **Framework** | Qt Quick / QML via Quickshell runtime |
| **Config root** | `~/.config/quickshell/ii/` (referenced as `$qsConfig = ii`) |
| **Architecture** | Services (singletons for state/data) + Modules (UI components) |
| **IPC** | `IpcHandler` targets in QML, called from Hyprland keybinds |
| **Shortcuts** | `GlobalShortcut` QML type registers Hyprland-level shortcuts |
| **Data storage** | `FileView` component for JSON persistence, `StandardPaths` for locations |
| **Theming** | `Appearance.qml` for colors/fonts, `matugen` for auto-generated palettes |

### Kitty

| Aspect | Detail |
|--------|--------|
| **Role** | GPU-accelerated terminal emulator |
| **Config** | Single file: `~/.config/kitty/kitty.conf` |
| **Shell** | Fish |
| **Font** | JetBrains Mono Nerd Font, 11pt |
| **Theme** | Matched to Hyprland — cyan accent, dark background |
| **Layouts** | Tall (default), fat, splits, stack |
| **Tab style** | Powerline/rounded, color-coded active/inactive |

### Sticky Notes (Custom Widget)

| Aspect | Detail |
|--------|--------|
| **Role** | Desktop sticky notes — create, edit, persist, pin |
| **Status** | Phase 1 plan 1 complete (~7%), plan 2 pending |
| **Framework** | Quickshell/QML, lives in `modules/ii/stickyNotes/` |
| **Service** | `StickyNotesService.qml` — CRUD, persistence, archiving, z-ordering |
| **Data** | `~/.local/share/quickshell/sticky-notes.json` (survives config resets) |
| **IPC** | Target `stickyNotes` — toggle, open, close, create |
| **Shortcuts** | `Super+Shift+G` toggle panel, `Super+Shift+N` new note |
| **Color palette** | 8 muted colors: Sand, Rose, Slate, Sage, Peach, Mauve, Mist, Stone |
| **Roadmap** | 7 phases: Foundation → Multi-Note → Overlay → Standalone → Resize → Context Menu → Text Polish |
| **Planning docs** | `~/.config/hypr/.planning/` (PROJECT.md, ROADMAP.md, REQUIREMENTS.md, STATE.md) |

## Theme Consistency

All components share the same color palette:

| Role | Hex | Used In |
|------|-----|---------|
| Background | `#121318` | Hyprland borders, Kitty tab bar, general dark base |
| Text | `#e2e2e9` | Kitty inactive tab text, general light text |
| Accent (active) | `#0DB7D4` | Hyprland active border, Kitty active tab, Quickshell highlights |
| Inactive border | `#313136` | Hyprland inactive border, Kitty split inactive border |
| Secondary accent | `#b0c6ff` | Kitty bell border, Quickshell secondary highlights |
| Sticky note colors | 8 muted tones | StickyNotesService palette (Sand, Rose, Slate, Sage, Peach, Mauve, Mist, Stone) |

Quickshell uses `Appearance.qml` and `matugen`-generated colors. Kitty and Hyprland use hardcoded hex values that match.

## System Services

Started by Hyprland at login (`exec-once` in `hyprland/execs.conf`):

| Service | Purpose |
|---------|---------|
| Quickshell (`qs -c ii`) | Desktop shell — bar, panels, overlays, widgets |
| `gnome-keyring-daemon` | Credential/secret storage |
| `cliphist` (via `wl-paste`) | Clipboard history |
| EasyEffects | PipeWire audio processing |
| `hyprpm reload` | Load Hyprland plugins |
| GeoClue agent | Location services |
| Wallpaper restore | Restores last wallpaper from swww cache |

## Critical Dependencies

| Tool | What Uses It | Purpose |
|------|-------------|---------|
| `hyprctl` | Scripts, IPC | Hyprland runtime control |
| `jq` | Scripts | JSON parsing |
| `wl-copy` / `wl-paste` | Clipboard, screenshots | Wayland clipboard |
| `brightnessctl` | Keybinds, OSD | Screen brightness |
| `wpctl` | Keybinds, Audio service | PipeWire volume |
| `playerctl` | Media keybinds | Media player control |
| `grim` / `slurp` | Screenshot keybinds | Screen capture + region select |
| `tesseract` | OCR keybind | Text recognition |
| `fuzzel` | Fallback launcher | Menu when Quickshell unavailable |
| `nwg-displays` | Monitor config | Auto-generates monitors.conf/workspaces.conf |
| `matugen` | Theme generation | Color palette from wallpaper |

## Where Things Get Stored

| What | Where | Format |
|------|-------|--------|
| Hyprland config | `~/.config/hypr/` | `.conf` files |
| Quickshell config | `~/.config/quickshell/ii/` | QML files |
| Kitty config | `~/.config/kitty/kitty.conf` | Kitty config format |
| Fish config | `~/.config/fish/` | Fish shell format |
| Sticky notes data | `~/.local/share/quickshell/sticky-notes.json` | JSON |
| Clipboard history | Managed by `cliphist` | Internal database |
| Wallpaper state | Managed by `swww` | Cache |
| Lock screen colors | `~/.config/hypr/hyprlock/colors.conf` | Auto-generated by matugen |
| Planning/roadmap | `~/.config/hypr/.planning/` | Markdown |
| This hub | `~/Documents/Hub/` | Markdown |

---

*Created: 2026-02-12*
*-> See [keybindings.md](keybindings.md) for all keyboard shortcuts*
*-> See [changelog.md](changelog.md) for work history*
*-> See [sticky-notes.md](sticky-notes.md) for sticky notes project details*
